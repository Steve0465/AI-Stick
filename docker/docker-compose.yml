version: "3.8"

services:
  # Local LLM Server
  ollama:
    image: ollama/ollama:latest
    container_name: ai-stick-ollama
    ports:
      - "11434:11434"
    volumes:
      - ../Mobile_Brain/models:/root/.ollama
    restart: unless-stopped

  # LLM Chat UI
  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: ai-stick-webui
    ports:
      - "3000:8080"
    environment:
      - OLLAMA_BASE_URL=http://ollama:11434
    volumes:
      - ./open-webui:/app/backend/data
    depends_on:
      - ollama
    restart: unless-stopped

  # Automation Engine
  n8n:
    image: n8nio/n8n:latest
    container_name: ai-stick-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=aistick
    volumes:
      - ./n8n:/home/node/.n8n
      - ../scripts:/scripts
      - ../results:/results
    restart: unless-stopped

  # Dashboard
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: ai-stick-dashboard
    ports:
      - "3001:3000"
    volumes:
      - ./homepage:/app/config
    restart: unless-stopped

  # Tailscale for remote access
  tailscale:
    image: tailscale/tailscale:latest
    container_name: ai-stick-tailscale
    hostname: ai-stick
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY:-}
      - TS_STATE_DIR=/var/lib/tailscale
    volumes:
      - ./tailscale:/var/lib/tailscale
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    restart: unless-stopped
